<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Ganko Dice</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: #111;
  color: #fff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

/* ğŸ² ã‚µã‚¤ã‚³ãƒ­æç”»ã‚¨ãƒªã‚¢ï¼ˆUIå®Œå…¨é™¤å¤–ï¼‰ */
#diceArea {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 200px; /* UIé«˜ã•åˆ† */
}

/* ã‚µã‚¤ã‚³ãƒ­æ–‡å­— */
.dice {
  position: absolute;
  font-size: 64px;
  font-weight: bold;
  user-select: none;
  pointer-events: none;
}

/* ğŸ”˜ UIã‚¨ãƒªã‚¢ */
#uiArea {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 200px;
  padding: 12px;
  box-sizing: border-box;
  background: #111;
  border-top: 1px solid #333;
}

.row {
  margin-bottom: 10px;
}

label {
  margin-right: 8px;
}

input[type="text"] {
  width: 100%;
  padding: 6px;
  font-size: 16px;
  box-sizing: border-box;
}

.radio-group label {
  margin-right: 12px;
}

#rollBtn {
  width: 100%;
  padding: 14px;
  font-size: 20px;
  border-radius: 12px;
  border: none;
  background: #ff9800;
  color: #000;
  cursor: pointer;
}
</style>
</head>

<body>

<div id="diceArea"></div>

<div id="uiArea">

  <!-- â‘  æ–‡å­—å…¥åŠ› -->
  <div class="row">
    <label>å‡ºç›®æ–‡å­—ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
    <input id="symbolInput" type="text" value="ã¡,ã¾,ãŒ,ãŠ,ã†,ã‚“ã“">
  </div>

  <!-- â‘¡ ã‚µã‚¤ã‚³ãƒ­æ•° -->
  <div class="row radio-group">
    <label>ã‚µã‚¤ã‚³ãƒ­æ•°ï¼š</label>
    <span id="diceCountRadios"></span>
  </div>

  <!-- ãƒœã‚¿ãƒ³ -->
  <button id="rollBtn">ğŸ² ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹</button>
</div>

<script>
const diceArea = document.getElementById('diceArea');
const btn = document.getElementById('rollBtn');
const symbolInput = document.getElementById('symbolInput');
const diceCountRadios = document.getElementById('diceCountRadios');

/* ğŸ”Š ãƒ­ãƒ¼ã‚«ãƒ«éŸ³å£° */
const diceSound = new Audio('rpg-dice-rolling-95182 3.mp3');
diceSound.preload = 'auto';

const MIN_DIST = 90;
const MAX_TRIES = 50;

/* ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ç”Ÿæˆï¼ˆ1ã€œ10ï¼Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ3ï¼‰ */
for (let i = 1; i <= 10; i++) {
  const label = document.createElement('label');
  const radio = document.createElement('input');
  radio.type = 'radio';
  radio.name = 'diceCount';
  radio.value = i;
  if (i === 3) radio.checked = true;

  label.appendChild(radio);
  label.append(` ${i}`);
  diceCountRadios.appendChild(label);
}

function getDiceCount() {
  return Number(document.querySelector('input[name="diceCount"]:checked').value);
}

function getSymbols() {
  return symbolInput.value
    .split(',')
    .map(s => s.trim())
    .filter(s => s.length > 0);
}

function isFarEnough(x, y, placed) {
  for (const p of placed) {
    if (Math.hypot(x - p.x, y - p.y) < MIN_DIST) {
      return false;
    }
  }
  return true;
}

function rollDice() {
  diceArea.innerHTML = '';

  const symbols = getSymbols();
  if (symbols.length === 0) return;

  diceSound.currentTime = 0;
  diceSound.play();

  const rect = diceArea.getBoundingClientRect();
  const w = rect.width;
  const h = rect.height;

  const placed = [];
  const diceCount = getDiceCount();

  for (let i = 0; i < diceCount; i++) {
    let x, y, tries = 0;

    do {
      x = Math.random() * (w - 80);
      y = Math.random() * (h - 80);
      tries++;
    } while (!isFarEnough(x, y, placed) && tries < MAX_TRIES);

    placed.push({ x, y });

    const d = document.createElement('div');
    d.className = 'dice';
    d.textContent = symbols[Math.floor(Math.random() * symbols.length)];

    const rot = Math.floor(Math.random() * 360);
    d.style.left = x + 'px';
    d.style.top = y + 'px';
    d.style.transform = `rotate(${rot}deg)`;

    diceArea.appendChild(d);
  }
}

btn.addEventListener('click', rollDice);
</script>

</body>
</html>
